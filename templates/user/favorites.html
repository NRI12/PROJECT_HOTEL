<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yêu Thích - Hotel Booking</title>
</head>
<body>
    <div>
        <div>
            <h1>Khách Sạn Yêu Thích</h1>
        </div>
        
        <div>
            <div id="errorContainer"></div>
            <div id="loadingContainer">Đang tải...</div>
            
            <div id="favoritesContainer"></div>
            
            <div id="paginationContainer"></div>
            
            <div>
                <a href="profile.html">Quay lại hồ sơ</a>
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        let currentPage = 1;
        const perPage = 10;

        async function loadFavorites(page = 1) {
            currentPage = page;
            const loadingContainer = document.getElementById('loadingContainer');
            const errorContainer = document.getElementById('errorContainer');
            const favoritesContainer = document.getElementById('favoritesContainer');
            const paginationContainer = document.getElementById('paginationContainer');

            loadingContainer.style.display = 'block';
            errorContainer.innerHTML = '';
            favoritesContainer.innerHTML = '';

            try {
                const result = await userAPI.getFavorites(page, perPage);
                
                if (result.success && result.data) {
                    loadingContainer.style.display = 'none';
                    
                    if (result.data.length === 0) {
                        favoritesContainer.innerHTML = '<div>Bạn chưa có khách sạn yêu thích nào</div>';
                        paginationContainer.innerHTML = '';
                        return;
                    }

                    let html = '';
                    result.data.forEach(favorite => {
                        const hotel = favorite.hotel || {};
                        html += `
                            <div>
                                <div>
                                    <h3>${hotel.name || 'N/A'}</h3>
                                    <div>Địa chỉ: ${hotel.address || 'N/A'}</div>
                                    <div>Ngày thêm: ${favorite.created_at ? new Date(favorite.created_at).toLocaleDateString('vi-VN') : 'N/A'}</div>
                                </div>
                            </div>
                        `;
                    });
                    favoritesContainer.innerHTML = html;

                    if (result.pagination) {
                        displayPagination(result.pagination, paginationContainer);
                    }
                } else {
                    loadingContainer.style.display = 'none';
                    if (result.status === 401) {
                        window.location.href = '../auth/login.html';
                    } else {
                        errorContainer.innerHTML = `<div>${result.message || 'Không thể tải danh sách yêu thích'}</div>`;
                    }
                }
            } catch (error) {
                loadingContainer.style.display = 'none';
                errorContainer.innerHTML = `<div>Lỗi: ${error.message}</div>`;
            }
        }

        function displayPagination(pagination, container) {
            if (!pagination || pagination.pages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '<div>';
            
            if (pagination.page > 1) {
                html += `<button onclick="loadFavorites(${pagination.page - 1})">Trước</button>`;
            }
            
            html += `<span>Trang ${pagination.page} / ${pagination.pages}</span>`;
            
            if (pagination.page < pagination.pages) {
                html += `<button onclick="loadFavorites(${pagination.page + 1})">Sau</button>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        window.addEventListener('DOMContentLoaded', async () => {
            const isValid = await verifyTokenWithBackend();
            if (!isValid) {
                window.location.href = '../auth/login.html';
                return;
            }
            await loadFavorites(1);
        });
    </script>
</body>
</html>

