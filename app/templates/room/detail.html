<!DOCTYPE html>
<html>
<head>
    <title>Chi tiết phòng</title>
</head>
<body>
    <h1>Chi tiết phòng</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="message {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    {% if result and result[0].get_json() and result[0].get_json().success %}
        {% set room = result[0].get_json().data.room %}
        
        <h2>Thông tin cơ bản</h2>
        <p><strong>ID:</strong> {{ room.room_id }}</p>
        <p><strong>Khách sạn:</strong> {{ room.hotel.hotel_name if room.hotel else '' }}</p>
        <p><strong>Tên phòng:</strong> {{ room.room_name }}</p>
        <p><strong>Số phòng:</strong> {{ room.room_number or 'Chưa có' }}</p>
        <p><strong>Loại phòng:</strong> {{ room.room_type.type_name if room.room_type else '' }}</p>
        <p><strong>Diện tích:</strong> {{ room.area or '' }} m²</p>
        <p><strong>Số khách tối đa:</strong> {{ room.max_guests }}</p>
        <p><strong>Số giường:</strong> {{ room.num_beds }}</p>
        <p><strong>Loại giường:</strong> {{ room.bed_type or 'Chưa có' }}</p>
        <p><strong>Giá cơ bản:</strong> {{ room.base_price }} VNĐ/đêm</p>
        <p><strong>Giá cuối tuần:</strong> {{ room.weekend_price or 'Không có' }} VNĐ/đêm</p>
        <p><strong>Số lượng phòng:</strong> {{ room.quantity }}</p>
        <p><strong>Trạng thái:</strong> {{ room.status }}</p>
        <p><strong>Mô tả:</strong> {{ room.description or 'Chưa có' }}</p>
        
        <h2>Hình ảnh</h2>
        {% if room.images %}
            <div>
                {% for img in room.images %}
                    <div style="display:inline-block; margin:10px;">
                        <img src="{{ img.image_url }}" alt="Room image" style="max-width: 200px; max-height: 200px;">
                        {% if img.is_primary %}
                            <p><strong>[Ảnh chính]</strong></p>
                        {% endif %}
                        <form method="POST" action="/room/{{ room.room_id }}/images/{{ img.image_id }}/delete">
                            <button type="submit" onclick="return confirm('Xác nhận xóa ảnh?')">Xóa</button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Chưa có hình ảnh</p>
        {% endif %}
        
        <form method="POST" action="/room/{{ room.room_id }}/images" enctype="multipart/form-data">
            <label>Thêm hình ảnh:</label>
            <input type="file" name="images" multiple accept="image/*">
            <button type="submit">Tải lên</button>
        </form>
        
        <h2>Tiện nghi</h2>
        {% if room.amenities %}
            <ul>
                {% for amenity in room.amenities %}
                    <li>{{ amenity.amenity_name }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Chưa có tiện nghi</p>
        {% endif %}
        <p><a href="/room/{{ room.room_id }}/amenities">Quản lý tiện nghi</a></p>
        
        <h2>Kiểm tra phòng trống</h2>
        <form method="GET" action="/room/{{ room.room_id }}/availability">
            <label>Ngày nhận phòng:</label>
            <input type="date" name="check_in" required>
            
            <label>Ngày trả phòng:</label>
            <input type="date" name="check_out" required>
            
            <button type="submit">Kiểm tra</button>
        </form>
        
        <h2>Cập nhật trạng thái</h2>
        <form method="POST" action="/room/{{ room.room_id }}/status">
            <label>Trạng thái:</label>
            <select name="status" required>
                <option value="available" {% if room.status == 'available' %}selected{% endif %}>Có sẵn</option>
                <option value="unavailable" {% if room.status == 'unavailable' %}selected{% endif %}>Không có sẵn</option>
                <option value="maintenance" {% if room.status == 'maintenance' %}selected{% endif %}>Bảo trì</option>
            </select>
            <button type="submit">Cập nhật</button>
        </form>
        
        <h2>Hành động</h2>
        <p>
            <a href="/room/{{ room.room_id }}/edit">Sửa thông tin</a> |
            <a href="/booking/create?room_id={{ room.room_id }}">Đặt phòng</a>
        </p>
        
    {% else %}
        <p>Không thể tải thông tin phòng</p>
    {% endif %}
    
    <p><a href="/room">Quay lại danh sách</a></p>
</body>
</html>