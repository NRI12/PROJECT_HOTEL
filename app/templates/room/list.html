<!DOCTYPE html>
<html>
<head>
    <title>Danh sách phòng</title>
</head>
<body>
    <h1>Danh sách phòng</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="message {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <form method="GET" action="/room/">
        <label>Khách sạn:</label>
        <input type="number" name="hotel_id" value="{{ request.args.hotel_id or '' }}" placeholder="ID khách sạn">
        
        <label>Trạng thái:</label>
        <select name="status">
            <option value="">Tất cả</option>
            <option value="available" {% if request.args.status == 'available' %}selected{% endif %}>Có sẵn</option>
            <option value="unavailable" {% if request.args.status == 'unavailable' %}selected{% endif %}>Không có sẵn</option>
            <option value="maintenance" {% if request.args.status == 'maintenance' %}selected{% endif %}>Bảo trì</option>
        </select>
        
        <button type="submit">Lọc</button>
    </form>
    
    <p><a href="/room/create">Tạo phòng mới</a></p>
    
    {% if result and result[0].get_json() and result[0].get_json().success %}
        {% set data = result[0].get_json().data %}
        {% set rooms = data.items %}
        
        {% if rooms %}
            <table border="1">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Khách sạn</th>
                        <th>Tên phòng</th>
                        <th>Số phòng</th>
                        <th>Loại phòng</th>
                        <th>Diện tích</th>
                        <th>Số khách</th>
                        <th>Giá cơ bản</th>
                        <th>Giá cuối tuần</th>
                        <th>Số lượng</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for room in rooms %}
                        <tr>
                            <td>{{ room.room_id }}</td>
                            <td>{{ room.hotel.hotel_name if room.hotel else '' }}</td>
                            <td><a href="/room/{{ room.room_id }}">{{ room.room_name }}</a></td>
                            <td>{{ room.room_number or '' }}</td>
                            <td>{{ room.room_type.type_name if room.room_type else '' }}</td>
                            <td>{{ room.area or '' }} m²</td>
                            <td>{{ room.max_guests }}</td>
                            <td>{{ room.base_price }} VNĐ</td>
                            <td>{{ room.weekend_price or '' }} VNĐ</td>
                            <td>{{ room.quantity }}</td>
                            <td>{{ room.status }}</td>
                            <td>
                                <a href="/room/{{ room.room_id }}/edit">Sửa</a> |
                                <form method="POST" action="/room/{{ room.room_id }}/delete" style="display:inline;">
                                    <button type="submit" onclick="return confirm('Xác nhận xóa?')">Xóa</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <p>
                Trang {{ data.page }} / {{ data.pages }} - Tổng {{ data.total }} phòng
            </p>
            
            {% if data.page > 1 %}
                <a href="/room/?page={{ data.page - 1 }}&hotel_id={{ request.args.hotel_id or '' }}&status={{ request.args.status or '' }}">Trang trước</a>
            {% endif %}
            
            {% if data.page < data.pages %}
                <a href="/room/?page={{ data.page + 1 }}&hotel_id={{ request.args.hotel_id or '' }}&status={{ request.args.status or '' }}">Trang sau</a>
            {% endif %}
        {% else %}
            <p>Chưa có phòng nào</p>
        {% endif %}
        
    {% else %}
        <p>Không thể tải danh sách phòng</p>
    {% endif %}
    
    <p><a href="/hotel">Quay lại danh sách khách sạn</a></p>
</body>
</html>