<!DOCTYPE html>
<html>
<head>
    <title>Khuyến mãi đang hoạt động</title>
</head>
<body>
    <h1>Khuyến mãi đang hoạt động</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <p class="flash-{{ category }}">{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% set payload = result[0].json if result and result[1] == 200 else None %}
    {% set promotions = payload.data.promotions if payload and payload.data and payload.data.promotions else [] %}

    {% if promotions %}
        <table border="1">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tiêu đề</th>
                    <th>Phạm vi</th>
                    <th>Loại giảm</th>
                    <th>Giá trị</th>
                    <th>Bắt đầu</th>
                    <th>Kết thúc</th>
                    <th>Ngày áp dụng</th>
                    <th>Số đêm tối thiểu</th>
                </tr>
            </thead>
            <tbody>
                {% for promo in promotions %}
                <tr>
                    <td>{{ promo.promotion_id }}</td>
                    <td>{{ promo.title }}</td>
                    <td>
                        {% if promo.room %}
                            Phòng #{{ promo.room.room_id }}
                        {% elif promo.hotel %}
                            Khách sạn #{{ promo.hotel.hotel_id }}
                        {% else %}
                            Toàn hệ thống
                        {% endif %}
                    </td>
                    <td>{{ 'Phần trăm' if promo.discount_type == 'percentage' else 'Cố định' }}</td>
                    <td>{{ promo.discount_value }}</td>
                    <td>{{ promo.start_date }}</td>
                    <td>{{ promo.end_date }}</td>
                    <td>{{ promo.applicable_days or 'Tất cả' }}</td>
                    <td>{{ promo.min_nights or 1 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Không có khuyến mãi đang hoạt động.</p>
    {% endif %}

    <p>
        <a href="{{ url_for('promotion.list_promotions') }}">Về danh sách</a> |
        <a href="{{ url_for('promotion.create_promotion') }}">Tạo khuyến mãi</a>
    </p>
</body>
</html>

