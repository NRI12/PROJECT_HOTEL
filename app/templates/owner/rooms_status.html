{% extends "owner/base.html" %}

{% block title %}Trạng thái Phòng{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">
            <i class="fas fa-door-open me-2"></i> Trạng thái Phòng
        </h1>
        <p class="owner-header-subtitle">Quản lý và theo dõi trạng thái các phòng</p>
    </div>
    <div class="owner-header-actions">
        <a href="{{ url_for('owner.dashboard') }}" class="owner-btn owner-btn-outline">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

{% set payload = result[0].json if result and result[1] == 200 else None %}
{% set rooms = payload.data.rooms if payload and payload.data and payload.data.rooms else [] %}

<!-- Summary Stats -->
{% if rooms %}
    {% set total_rooms = namespace(value=0) %}
    {% set active_rooms = namespace(value=0) %}
    {% for room in rooms %}
        {% set total_rooms.value = total_rooms.value + room.quantity %}
        {% if room.is_active %}
            {% set active_rooms.value = active_rooms.value + room.quantity %}
        {% endif %}
    {% endfor %}

    <div class="owner-stats-row mb-4">
        <div class="owner-stat-card">
            <div class="owner-stat-content">
                <h6>Tổng loại phòng</h6>
                <div class="stat-value">{{ rooms|length }}</div>
                <div class="stat-label">Loại phòng khác nhau</div>
            </div>
            <div class="owner-stat-icon">
                <i class="fas fa-layer-group"></i>
            </div>
        </div>

        <div class="owner-stat-card success">
            <div class="owner-stat-content">
                <h6>Tổng phòng</h6>
                <div class="stat-value">{{ total_rooms.value }}</div>
                <div class="stat-label">Tất cả phòng</div>
            </div>
            <div class="owner-stat-icon">
                <i class="fas fa-door-open"></i>
            </div>
        </div>

        <div class="owner-stat-card info">
            <div class="owner-stat-content">
                <h6>Phòng hoạt động</h6>
                <div class="stat-value">{{ active_rooms.value }}</div>
                <div class="stat-label">Đang sẵn sàng</div>
            </div>
            <div class="owner-stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>

        <div class="owner-stat-card warning">
            <div class="owner-stat-content">
                <h6>Phòng tạm dừng</h6>
                <div class="stat-value">{{ total_rooms.value - active_rooms.value }}</div>
                <div class="stat-label">Không hoạt động</div>
            </div>
            <div class="owner-stat-icon">
                <i class="fas fa-pause-circle"></i>
            </div>
        </div>
    </div>
{% endif %}

<!-- Rooms Table -->
<div class="owner-table-wrapper">
    <div class="owner-table-header">
        <h3 class="owner-table-title">
            <i class="fas fa-list me-2"></i> Danh sách phòng
        </h3>
        <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">
            {{ rooms|length }} loại phòng
        </span>
    </div>
    {% if rooms %}
        <div class="table-responsive">
            <table class="owner-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Khách sạn</th>
                        <th>Tên phòng</th>
                        <th class="text-center">Số lượng</th>
                        <th class="text-end">Giá cơ bản</th>
                        <th class="text-center">Trạng thái</th>
                        <th class="text-center">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    {% for room in rooms %}
                    <tr>
                        <td><strong>#{{ room.room_id }}</strong></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-hotel text-primary me-2"></i>
                                <div>
                                    <div class="text-muted small">Hotel ID: {{ room.hotel_id }}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-bed text-info me-2" style="font-size: 1.5rem;"></i>
                                <strong>{{ room.room_name }}</strong>
                            </div>
                        </td>
                        <td class="text-center">
                            <span class="badge bg-secondary" style="font-size: 0.9rem; padding: 0.5rem 0.75rem;">
                                <i class="fas fa-hashtag"></i> {{ room.quantity }}
                            </span>
                        </td>
                        <td class="text-end">
                            <strong class="text-success" style="font-size: 1.05rem;">
                                {{ "{:,.0f}".format(room.base_price) }} VNĐ
                            </strong>
                        </td>
                        <td class="text-center">
                            {% if room.is_active %}
                                <span class="owner-badge status-active">
                                    <i class="fas fa-check-circle"></i> Hoạt động
                                </span>
                            {% else %}
                                <span class="owner-badge status-inactive">
                                    <i class="fas fa-times-circle"></i> Tạm dừng
                                </span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('owner.owner_rooms') }}" class="btn btn-sm btn-info text-white" title="Xem danh sách phòng">
                                    <i class="fas fa-list"></i>
                                </a>
                                <a href="{{ url_for('owner.owner_rooms_edit', room_id=room.room_id) }}" class="btn btn-sm btn-warning text-white" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="owner-empty-state">
            <div class="owner-empty-icon">
                <i class="fas fa-bed"></i>
            </div>
            <h4 class="owner-empty-title">Không có phòng nào</h4>
            <p class="owner-empty-text">Chưa có phòng nào được tạo cho khách sạn của bạn.</p>
        </div>
    {% endif %}
</div>

{% endblock %}
