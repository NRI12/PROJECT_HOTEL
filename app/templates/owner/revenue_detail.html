{% extends "owner/base.html" %}

{% block title %}Chi tiết Doanh thu{% endblock %}

{% block content %}

<div class="owner-header">
    <div>
        <h1 class="owner-header-title">
            <i class="fas fa-file-invoice-dollar me-2"></i> Chi tiết Doanh thu
        </h1>
        <p class="owner-header-subtitle">Xem chi tiết từng booking đóng góp doanh thu</p>
    </div>
    <div class="owner-header-actions">
        <a href="{{ url_for('owner.revenue_summary') }}" class="owner-btn owner-btn-outline">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

<!-- Filter Bar -->
<div class="owner-filter-bar">
    <form method="GET" action="{{ url_for('owner.revenue_detail') }}">
        <div class="owner-filter-row">
            <div class="owner-filter-group">
                <label for="start_date">
                    <i class="fas fa-calendar-alt me-1"></i> Từ ngày
                </label>
                <input type="date" name="start_date" id="start_date" class="form-control" value="{{ request.args.get('start_date', '') }}">
            </div>
            <div class="owner-filter-group">
                <label for="end_date">
                    <i class="fas fa-calendar-alt me-1"></i> Đến ngày
                </label>
                <input type="date" name="end_date" id="end_date" class="form-control" value="{{ request.args.get('end_date', '') }}">
            </div>
            <div class="owner-filter-group" style="flex: 0;">
                <button type="submit" class="owner-btn owner-btn-primary">
                    <i class="fas fa-search"></i> Lọc
                </button>
            </div>
            <div class="owner-filter-group" style="flex: 0;">
                <a href="{{ url_for('owner.revenue_detail') }}" class="owner-btn owner-btn-secondary">
                    <i class="fas fa-redo"></i> Xóa lọc
                </a>
            </div>
        </div>
    </form>
</div>

{% set payload = result[0].json if result and result[1] == 200 else None %}
{% set data = payload.data if payload and payload.data else None %}
{% set bookings = data.bookings if data and data.bookings else [] %}

{% if bookings %}
    <!-- Summary Card -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="owner-stat-card" style="padding: 2rem;">
                <div class="owner-stat-content">
                    <h6>Tổng doanh thu</h6>
                    <div class="stat-value" style="font-size: 3rem; color: #198754;">
                        {{ "{:,.0f}".format(data.total_revenue) if data and data.total_revenue else 0 }} VNĐ
                    </div>
                    <div class="stat-label">Từ {{ bookings|length }} booking</div>
                </div>
                <div class="owner-stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Bookings Table -->
    <div class="owner-table-wrapper">
        <div class="owner-table-header">
            <h3 class="owner-table-title">
                <i class="fas fa-list me-2"></i> Chi tiết từng booking
            </h3>
            <span class="badge bg-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">
                {{ bookings|length }} booking
            </span>
        </div>
        <div class="table-responsive">
            <table class="owner-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Khách sạn</th>
                        <th>Khách hàng</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th class="text-center">Trạng thái</th>
                        <th class="text-end">Số tiền</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in bookings %}
                    <tr>
                        <td><strong>#{{ booking.booking_id }}</strong></td>
                        <td>
                            <i class="fas fa-hotel text-primary me-1"></i>
                            {{ booking.hotel.hotel_name if booking.hotel else 'N/A' }}
                        </td>
                        <td>
                            <i class="fas fa-user text-secondary me-1"></i>
                            {{ booking.user.full_name if booking.user else 'N/A' }}
                        </td>
                        <td>
                            <i class="far fa-calendar-alt me-1"></i>
                            {{ booking.check_in_date }}
                        </td>
                        <td>
                            <i class="far fa-calendar-alt me-1"></i>
                            {{ booking.check_out_date }}
                        </td>
                        <td class="text-center">
                            <span class="owner-badge status-{{ booking.status }}">
                                {{ booking.status }}
                            </span>
                        </td>
                        <td class="text-end">
                            <strong class="text-success" style="font-size: 1.1rem;">
                                {{ "{:,.0f}".format(booking.final_amount) }} VNĐ
                            </strong>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr style="background-color: #f8f9fa; font-weight: bold;">
                        <td colspan="6" class="text-end">TỔNG CỘNG:</td>
                        <td class="text-end" style="font-size: 1.3rem; color: #198754;">
                            {{ "{:,.0f}".format(data.total_revenue) if data and data.total_revenue else 0 }} VNĐ
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
{% else %}
    <div class="owner-empty-state">
        <div class="owner-empty-icon">
            <i class="fas fa-file-invoice-dollar"></i>
        </div>
        <h4 class="owner-empty-title">Không có dữ liệu</h4>
        <p class="owner-empty-text">Chưa có booking nào đóng góp doanh thu trong khoảng thời gian này.</p>
    </div>
{% endif %}

{% endblock %}
